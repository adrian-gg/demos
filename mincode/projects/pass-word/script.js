$(document).ready(function(){
  var data = {
    A: { questions: [
        [["CON LA A."], ["Dicho de una supuesta criatura extraterrestre: Apoderarse de alguien."]],
        [["CON LA A."], ["Palabra que significa lo contrario de una dada."]],
        [["CON LA A."], ["Cada uno de los significados que tiene una palabra."]]
      ], answers: ["A573298D","A760120D","A696490D"]
    },B: { questions: [
        [["CON LA B."], ["Juego que ha sacado de quicio a todos los 'Skylabers' en las sesiones de precurso."]],
        [["CON LA B."], ["Palabra que tiene dos sílabas."]],
        [["CON LA B."], ["Bonita in english is..."]]
      ], answers: ["B364798D","B676998D","B874900D"]
    },C: { questions: [
        [["CON LA C."], ["Niño, crío, bebé."]],
        [["CON LA C."], ["Más es un adverbio de..."]],
        [["CON LA C."], ["Historia contada en viñetas con dibujos y palabras."]]
      ], answers: ["C886774D","C678760D","C359370D"]
    },D: { questions: [
        [["CON LA D."], ["Anormalidad en la función del aparato digestivo caracterizada por frecuentes evacuaciones y su consistencia líquida."]],
        [["CON LA D."], ["Los artículos, demostrativos, posesivos, etc. Son..."]],
        [["CON LA D."], ["Libro en el que aparece el significado de las palabras por orden alfabético."]]
      ], answers: ["D570024D","D1572274D","D1150524D"]
    },E: { questions: [
        [["CON LA E."], ["Gelatinoso y se encuentra debajo de la membrana plasmática. Los cazafantasmas medían su radiación."]],
        [["CON LA E."], ["Palabra cuya sílaba tónica es la antepenúltima."]],
        [["CON LA E."], ["Grupo de versos que riman entre sí o tratan de un tema determinado."]]
      ], answers: ["E1022140D","E1186540D","E616588D"]
    },F: { questions: [
        [["CON LA F."], ["Que no requiere gran esfuerzo, capacidad o dificultad."]],
        [["CON LA F."], ["Tipo de enunciado que no tiene verbo."]],
        [["CON LA F."], ["Tiempo verbal que indica que la acción se va a realizar."]]
      ], answers: ["F343278D","F367524D","F539320D"]
    },G: { questions: [
        [["CON LA G."], ["Conjunto enorme de estrellas, polvo interestelar, gases y partículas."]],
        [["CON LA G."], ["Lo que nos indica si es masculino o femenino es el..."]],
        [["CON LA G."], ["Antónimo de leve."]]
      ], answers: ["G568390D","G481600D","G373000D"]
    },H: { questions: [
        [["CON LA H."], ["Suicidio ritual japonés por desentrañamiento."]],
        [["CON LA H."], ["Dos vocales juntas que forman dos sílabas distintas."]],
        [["CON LA H."], ["Palabras que se pronunciamos igual, pero tienen significados diferentes."]]
      ], answers: ["H712618D","H373000D","H892738D"]
    },I: { questions: [
        [["CON LA I."], ["Templo cristiano."]],
        [["CON LA I."], ["Forma no personal del verbo."]],
        [["CON LA I."], ["Enunciado que sirve para preguntar."]]
      ], answers: ["I579870D","I1069198D","I1640160D"]
    },J: { questions: [
        [["CON LA J."], ["Variedad salvaje del cerdo que sale en la película 'El Rey León', de nombre Pumba."]],
        [["CON LA J."], ["Apellido del autor de -Platero y yo-."]],
        [["CONTIENE LA J."], ["Que expresa cualidad o estado de los nombres a los que se refiere."]]
      ], answers: ["J438274D","J613210D","A732550D"]
    },L: { questions: [
        [["CON LA L."], ["Hombre lobo."]],
        [["CON LA L."], ["Artículo masculino plural."]],
        [["CON LA L."], ["Gran escritor español perteneciente al Siglo de Oro."]]
      ], answers: ["L1060570D","L205870D","L1132708D"]
    },M: { questions: [
        [["CON LA M."], ["Persona que huye del trato con otras personas o siente gran aversión hacia ellas."]],
        [["CON LA M."], ["Palabra que contiene una sola sílaba."]],
        [["CON LA M."], ["Los verbos españoles tienen tres: indicativo, subjuntivo e imperativo."]]
      ], answers: ["M1097460D","M1013688D","M391018D"]
    },N: { questions: [
        [["CON LA N."], ["Demostración de poca inteligencia."]],
        [["CON LA N."], ["Determinante que indica cantidad u orden."]],
        [["CON LA N."], ["Así llamamos también al sustantivo."]]
      ], answers: ["N537724D","N616588D","N486178D"]
    },Ñ: { questions: [
        [["CONTIENE LA Ñ."], ["Indicio que permite deducir algo de lo que no se tiene un conocimiento directo."]],
        [["CONTIENE LA Ñ."], ["Sinónimo de extrañar, echar de menos."]],
        [["CONTIENE LA Ñ."], ["Sinónimo de infancia."]]
      ], answers: ["S566758D","A703638D","N673480D"]
    },O: { questions: [
        [["CON LA O."], ["Humanoide fantástico de apariencia terrible y bestial, piel de color verde creada por el escritor Tolkien."]],
        [["CON LA O."], ["Enunciado con sentido completo y que tiene al menos un verbo."]],
        [["CON LA O."], ["Conjunto de normas que regulan la escritura."]]
      ], answers: ["O286738D","O601450D","O1032750D"]
    },P: { questions: [
        [["CON LA P."], ["Raza ancestral tecnológicamente avanzada que se caracteriza por sus grandes poderes psíonicos del videojuego StarCraft."]],
        [["CON LA P."], ["Palabras con más de un significado."]],
        [["CON LA P."], ["Palabras que tienen más de tres sílabas."]]
      ], answers: ["P682290D","P1197900D","P1184274D"]
    },Q: { questions: [
        [["CON LA Q."], ["Producto obtenido por la maduración de la cuajada de la leche."]],
        [["CONTIENE LA Q."], ["Dícese de la persona débil, enfermiza, muy flaca."]],
        [["CON LA Q."], ["Apellido real de Don Quijote antes de cambiarse de nombre."]]
      ], answers: ["Q406528D","E872928D","Q621670D"]
    },R: { questions: [
        [["CON LA R."], ["Roedor."]],
        [["CON LA R."], ["Los juglares recorrían las plazas de los pueblos recitándolos para divertir a la gente."]],
        [["CON LA R."], ["El que recibe la información."]]
      ], answers: ["R393820D","R736200D","R758268D"]
    },S: { questions: [
        [["CON LA S."], ["Comunidad salvadora de todo desarrollador informático."]],
        [["CON LA S."], ["Que tiene el mismo significado."]],
        [["CON LA S."], ["Palabra cuya sílaba tónica es la anterior a la antepenúltima."]]
      ], answers: ["S1632258D","S773140D","S1804738D"]
    },T: { questions: [
        [["CON LA T."], ["Película del director James Cameron que consolidó a Arnold Schwarzenegger como actor en 1984."]],
        [["CON LA T."], ["Obra de teatro que tiene un desenlace desgraciado."]],
        [["CON LA T."], ["Nombre de la sílaba que pronunciamos con más fuerza."]]
      ], answers: ["T1082200D","T694708D","T478558D"]
    },U: { questions: [
        [["CON LA U."], ["Escritor y filósofo español de la generación del 98 autor del libro 'Niebla' en 1914."]],
        [["CON LA U."], ["Adjetivo que sigue inmediatamente en orden al o a lo décimo."]],
        [["CON LA U."], ["Antónimo de Primero."]]
      ], answers: ["U642178D","U728908D","U521874D"]
    },V: { questions: [
        [["CON LA V."], ["Nombre dado a los miembros de los pueblos nórdicos originarios de Escandinavia, famosos por sus incursiones y pillajes en Europa."]],
        [["CON LA V."], ["Palabras que indican acción o estado."]],
        [["CON LA V."], ["Cada uno de los renglones cortos que forman una poesía."]]
      ], answers: ["V769410D","V385438D","V409374D"]
    },X: { questions: [
        [["CONTIENE LA X."], ["Toxina bacteriana utilizada en cirujía estética."]],
        [["CONTIENE LA X."], ["Prefijo que significa añadir algo..."]],
        [["CONTIENE LA X."], ["El verbo haber es un verbo..."]]
      ], answers: ["B405108D","E393820D","A749038D"]
    },Y: { questions: [
        [["CONTIENE LA Y."], ["Pequeño cáctus conocido por sus alcaloides psicoactivos utilizado de forma ritual y medicinal por indígenas americanos."]],
        [["CONTIENE LA Y."], ["Vocablo que imita o recrea un sonido."]],
        [["CON LA Y."], ["Pronombre personal, 1ª persona del singular."]]
      ], answers: ["P515590D","O1241524D","Y133560D"]
    },Z: { questions: [
        [["CON LA Z."], ["Escuela de budismo que busca la experiencia de la sabiduría más allá del discurso racional."]],
        [["CONTIENE LA Z."], ["Conjunto de fonemas mínimo e irreductible que comparten las palabras de una misma familia."]],
        [["CON LA Z."], ["Ruido que hacen algunos insectos como las abejas."]]
      ], answers: ["Z204768D","R290470D","Z626770D"]
    }
  }
  var letters = ['A','B','C','D','E','F','G','H','I','J','L','M','N','Ñ','O','P','Q','R','S','T','U','V','X','Y','Z'];
  var degrees = 360 / letters.length;
  var listQuestions = [];
  var tableResults = [ ["Aciertos", 0], ["Fallos", 0], ["Pass-words", 0] ];
  var time = 142;
  var count = 0;
  
  
  function temporizador(action){
    let boxTimer = $("#timer");
    boxTimer.css("background", `conic-gradient(white 0%, #202020 0, #202020 100%)`);
    
    if(action === "start"){
      var temporizador = setInterval(function(){
        
        count++;
        boxTimer.css("background", `conic-gradient(white ${(count * 100) / time}%, #202020 0, #202020 100%)`);
        
        if(count >= time){
          actions("timeOut");
          clearInterval(temporizador);
        }
        
      }, 1000);
      
    }
    else if(action === "finish"){
      //clearInterval(temporizador);
      count = time;
      
    }
  }
  
  function printLetters(degrees){
    for(var i = 0; i < letters.length; i++){
      $(".letters_container").append(`
      <div class="container_letter" style="rotate: ${degrees * i}deg" id="letter_${letters[i]}">
        <div class="letter" style="rotate: -${degrees * i}deg">${letters[i]}</div>
      </div>
      `)
    }
    
    //$("#letter_A .letter").addClass('letter_selected')
  }
  
  function createListQuestions(){
    for(var i = 0; i < letters.length; i++){
      const randomNumber = getRandomInt(3);
      listQuestions.push([
        letters[i],
        data[letters[i]]["questions"][randomNumber],
        data[letters[i]]["answers"][randomNumber]
      ]);
    }
    //console.log(listQuestions)
  }
  
  function checkAnswer(word){
    var nombre = word.toUpperCase();
    var contrasenya = "PASSWORD";
    var splitNombre = nombre.split('');
    var splitContrasenya = contrasenya.split('');
    var codeAtNombre = [], codeAtContrasenya = [];
    
    splitNombre.forEach(function (elementoN, array) {
      codeAtNombre.push(elementoN.charCodeAt(0));
    });
    splitContrasenya.forEach(function (elementoC, array) {
      codeAtContrasenya.push(elementoC.charCodeAt(0));
    });
    
    var sumaNombre = codeAtNombre.reduce(function(a, b){ return a + b; });
    var sumaContrasenya = codeAtContrasenya.reduce(function(a, b){ return a + b; });
    var result = splitNombre[0] + ((sumaNombre + sumaContrasenya) * sumaNombre) + splitContrasenya[splitContrasenya.length-1];
    
    return result === listQuestions[0][2];
    
  };

  function getRandomInt(max) {
    return Math.floor(Math.random() * max);
  }
  
  function printResults(){    
    $("#scene_questions").hide();
    $("#success_box").empty().append(tableResults[0][1]);
    $("#fails_box").empty().append(tableResults[1][1]);
    $("#passes_box").empty().append(tableResults[2][1]);
    $("#scene_results").show();
  }
  
  function printQuestions(){
    $(".letter").removeClass("letter_selected");
    
    if(listQuestions.length === 0){
      temporizador("finish");
      printResults();
      
    }else{
      $("#letter_"+listQuestions[0][0]+" .letter").addClass("letter_selected");
      $("#hint_box").empty().append(`${listQuestions[0][1][0]}`);
      $("#question_box").empty().append(`${listQuestions[0][1][1]}`);
    }
    
  }
  
  function actions(result){
    if(result === "pass"){
      listQuestions.push(listQuestions[0]);
      listQuestions.shift();
      //tableResults[2].splice(1, 1, tableResults[2][1]+1);
      
    }else if(result === "timeOut"){
      tableResults[2][1] = listQuestions.length;
      listQuestions = [];
      
    }else{
      if(result){
        $("#letter_"+listQuestions[0][0]+" .letter").addClass("letter_solved");
        tableResults[0].splice(1, 1, tableResults[0][1]+1);
        time = time + 5;
        
      }else{
        $("#letter_"+listQuestions[0][0]+" .letter").addClass("letter_wrong");
        tableResults[1].splice(1, 1, tableResults[1][1]+1);
        
      }
      listQuestions.shift();
      
    }
    printQuestions();
    
  }
  
  function reset(){
    listQuestions = [];
    tableResults = [ ["Aciertos", 0], ["Fallos", 0], ["Pass-words", 0] ];
    count = 0;
    createListQuestions();
    $(".letter").removeClass("letter_solved").removeClass("letter_wrong");
    printQuestions();
  }
  
  
  $("#start_btn").click(function(){
    $("#scene_title").hide();
    $("#scene_questions").show();
    printQuestions();
    temporizador("start");
    $("#input_answer").focus();
  });
  
  $("#send_btn").click(function(){    
    let answer = $("#input_answer").val();
    if(answer === ""){
      return $("#pass_btn").click()
    }
    
    $("#input_answer").val("").focus();
    actions(checkAnswer(answer));
    
  });
  
  $("#pass_btn").click(function(){
    actions("pass");
    $("#input_answer").focus();
  });
  
  $("#restart_btn").click(function(){
    reset();
    temporizador("start");
    $("#scene_results").hide();
    $("#scene_questions").show();
    $("#input_answer").focus();
  });
  
  $(document).on('keypress',function(e) {
      if(e.which == 13) {
        if($("#scene_title").is(":visible")){
          $("#start_btn").click();
          
        }else if($("#scene_questions").is(":visible")){
          $("#send_btn").click();
          
        }else if($("#scene_results").is(":visible")){
          $("#restart_btn").click();
          
        }
          
      }
  });
  
  
  createListQuestions(); 
  printLetters(degrees);
  
});